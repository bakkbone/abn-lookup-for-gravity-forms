function itsg_gf_abnlookup_function(e,o,i){var n=gf_abnlookup_settings.ajax_url,a=gf_abnlookup_settings.validation_message_loading,s=gf_abnlookup_settings.validation_message_not_valid,t=gf_abnlookup_settings.validation_message_error_communicating,l=gf_abnlookup_settings.validation_message_11_char,r=gf_abnlookup_settings.text_checking,_=gf_abnlookup_settings.text_check_abn,d=gf_abnlookup_settings.gst_value_yes,u=gf_abnlookup_settings.gst_value_no,p=gf_abnlookup_settings.lookup_timeout,g=gf_abnlookup_settings.lookup_retries,f=gf_abnlookup_settings.nonce;!function(o){"use strict";var i=!1,c=jQuery(".gform_abnlookup_field_"+e+' input[type="text"]'),y=jQuery(".gform_abnlookup_field_"+e+" .gfield_description.validation_message"),h=jQuery(".itsg_abnlookup_response_"+e),b=jQuery(".itsg_abnlookup_checkabn_"+e),v=jQuery(".gform_abnlookup_entity_gst_field_"+e),m=jQuery(".gform_abnlookup_entity_gst_field_"+e+' input[value="'+d+'"]'),k=jQuery(".gform_abnlookup_entity_gst_field_"+e+' input[value="'+u+'"]'),j=jQuery(".gform_abnlookup_entity_type_field_"+e),Q=jQuery(".gform_abnlookup_entity_type_field_"+e+" input"),C=jQuery(".gform_abnlookup_entity_status_field_"+e),x=jQuery(".gform_abnlookup_entity_status_field_"+e+" input"),w=jQuery(".gform_abnlookup_entity_name_field_"+e),N=jQuery(".gform_abnlookup_entity_name_field_"+e+" input"),E=jQuery(".gform_abnlookup_entity_postcode_field_"+e),A=jQuery(".gform_abnlookup_entity_postcode_field_"+e+" input"),D=jQuery(".gform_abnlookup_entity_state_field_"+e),S=jQuery(".gform_abnlookup_entity_state_field_"+e+" input"),O=jQuery(".gform_abnlookup_entity_effective_from_field_"+e),T=jQuery(".gform_abnlookup_entity_effective_from_field_"+e+" input"),F=jQuery(".gform_abnlookup_gst_effective_from_field_"+e),V=jQuery(".gform_abnlookup_gst_effective_from_field_"+e+" input"),B=jQuery(".gform_abnlookup_business_name_field_"+e),P=jQuery(".gform_abnlookup_business_name_field_"+e+" select");jQuery(".gform_abnlookup_business_name_field_"+e+" option");""!==h.html()?((m.is(":visible")&&1!=m.prop("checked")&&1!=k.prop("checked")||Q.is(":visible")&&""==Q.val()||x.is(":visible")&&""==x.val()||N.is(":visible")&&""==N.val()||A.is(":visible")&&""==A.val()||S.is(":visible")&&""==S.val()||T.is(":visible")&&""==T.val()||P.is(":visible")&&""==P.val()||V.is(":visible")&&""==V.val())&&c.trigger("change"),m.is(":checked")?k.prop("disabled",!0):k.is(":checked")&&m.prop("disabled",!0),Q.prop("readonly",!0),x.prop("readonly",!0),N.prop("readonly",!0),A.prop("readonly",!0),S.prop("readonly",!0),T.prop("readonly",!0),V.prop("readonly",!0)):(v.closest("li.gfield").hide(),j.closest("li.gfield").hide(),C.closest("li.gfield").hide(),w.closest("li.gfield").hide(),E.closest("li.gfield").hide(),D.closest("li.gfield").hide(),O.closest("li.gfield").hide(),F.closest("li.gfield").hide(),B.closest("li.gfield").hide()),c.unbind("change").change((function(){var d=jQuery(this).val().replace(/\D/g,"");if(11==d.length){gf_abnlookup_settings.debug&&console.log(d);var u={action:"itsg_gf_abnlookup_check_ajax",abn:d,nonce:f};i&&4!==i.readyState&&(gf_abnlookup_settings.debug&&console.log("Abort! -- another request has been submitted."),i.abort()),i=function(i){return o.ajax({type:"POST",url:n,data:i,tryCount:0,retryLimit:g,beforeSend:function(){y.hide(),h.html(a),b.val(r+" ... "),h.addClass("loading"),h.removeClass("error Active Cancelled validation_message")},success:function(o){if(void 0!==o)try{gf_abnlookup_settings.debug&&console.log(o),b.val(_);var i=JSON.parse(o);if(null!=i.exception)y.hide(),"Search text is not a valid ABN or ACN"==i.exception.exceptionDescription?h.html(s):h.text(i.exception.exceptionDescription),h.removeClass("Active Cancelled loading"),h.addClass("error validation_message"),v.hide(),j.hide(),C.hide(),w.hide(),E.hide(),D.hide(),O.hide(),F.hide(),B.hide(),Q.val("").change(),x.val("").change(),N.val("").change(),A.val("").change(),S.val("").change(),T.val("").change(),V.val("").change(),jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove(),m.prop("disabled",!1),k.prop("disabled",!1),m.prop("checked",!1).change().keyup(),k.prop("checked",!1).change().keyup(),Q.prop("readonly",!1),x.prop("readonly",!1),N.prop("readonly",!1),A.prop("readonly",!1),S.prop("readonly",!1),T.prop("readonly",!1),V.prop("readonly",!1);else if(null!=i.businessEntity202001){gf_abnlookup_settings.debug&&console.log(i.businessEntity202001);var n=i.businessEntity202001.entityType.entityTypeCode,a=i.businessEntity202001.entityType.entityDescription,t=i.businessEntity202001.entityStatus.entityStatusCode,l=i.businessEntity202001.mainBusinessPhysicalAddress.postcode,r=i.businessEntity202001.mainBusinessPhysicalAddress.stateCode,d=i.businessEntity202001.entityStatus.effectiveFrom,u=i.businessEntity202001.businessName,p=("0"+(G=new Date(d)).getDate()).slice(-2),g=("0"+(G.getMonth()+1)).slice(-2),f=G.getFullYear();if(T.hasClass("dmy"))var c=p+"/"+g+"/"+f;else c=T.hasClass("dmy_dash")?p+"-"+g+"-"+f:T.hasClass("dmy_dot")?p+"."+g+"."+f:T.hasClass("ymd_slash")?f+"/"+g+"/"+G:T.hasClass("ymd_dash")?f+"-"+g+"-"+G:T.hasClass("ymd_dot")?f+"."+g+"."+G:g+"/"+p+"/"+f;if(null!=i.businessEntity202001.goodsAndServicesTax){var G,L=i.businessEntity202001.goodsAndServicesTax.effectiveFrom;if(p=("0"+(G=new Date(L)).getDate()).slice(-2),g=("0"+(G.getMonth()+1)).slice(-2),f=G.getFullYear(),T.hasClass("dmy"))var M=p+"/"+g+"/"+f;else M=V.hasClass("dmy_dash")?p+"-"+g+"-"+f:V.hasClass("dmy_dot")?p+"."+g+"."+f:V.hasClass("ymd_slash")?f+"/"+g+"/"+G:V.hasClass("ymd_dash")?f+"-"+g+"-"+G:V.hasClass("ymd_dot")?f+"."+g+"."+G:g+"/"+p+"/"+f;V.val(M).change(),V.prop("readonly",!0),F.show()}else F.hide(),V.val("").change();if("IND"==n)var Y=("string"==typeof i.businessEntity202001.legalName.familyName?i.businessEntity202001.legalName.familyName:"")+", "+("string"==typeof i.businessEntity202001.legalName.givenName?i.businessEntity202001.legalName.givenName:"")+" "+("string"==typeof i.businessEntity202001.legalName.otherGivenName?i.businessEntity202001.legalName.otherGivenName:"");else Y=i.businessEntity202001.mainName.organisationName;if(void 0!==u){gf_abnlookup_settings.debug&&console.log(u),jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove();var q=new Option(Y,Y,!0,!0);if(P.append(q),u.length)u.forEach((function(e,o,i){var n=new Option(e.organisationName,e.organisationName,!1,!1);P.append(n)}));else{var I=new Option(u.organisationName,u.organisationName,!1,!1);P.append(I)}}else jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove(),q=new Option(Y,Y,!0,!0),P.append(q);y.hide(),h.text(t+" - "+Y),Q.val(a).change(),Q.prop("readonly",!0),x.val(t).change(),x.prop("readonly",!0),N.val(Y).change(),N.prop("readonly",!0),A.val(l).change(),A.prop("readonly",!0),S.val(r).change(),S.prop("readonly",!0),T.val(c).change(),T.prop("readonly",!0),h.removeClass("error loading validation_message"),h.addClass(t),null!=i.businessEntity202001.goodsAndServicesTax&&"0001-01-01"==i.businessEntity202001.goodsAndServicesTax.effectiveTo?(m.prop("checked",!0).click().change().keyup(),m.prop("disabled",!1),k.prop("disabled",!0)):(k.prop("checked",!0).click().change().keyup(),k.prop("disabled",!1),m.prop("disabled",!0)),v.show(),j.show(),w.show(),C.show(),E.show(),D.show(),O.show(),B.show()}}catch(e){gf_abnlookup_settings.debug&&console.log(o),h.text(e),h.removeClass("loading Active Cancelled"),h.addClass("error validation_message")}},error:function(e,i,n){if("timeout"==i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void o.ajax(this);h.text(t)}else h.text(e.responseText);b.val(_),h.removeClass("loading Active Cancelled"),h.addClass("error validation_message")},timeout:p})}(u)}else v.hide(),j.hide(),C.hide(),w.hide(),E.hide(),D.hide(),O.hide(),F.hide(),B.hide(),Q.val("").change(),x.val("").change(),N.val("").change(),A.val("").change(),S.val("").change(),T.val("").change(),jQuery(".gform_abnlookup_business_name_field_"+e+" option").remove(),V.val("").change(),m.prop("disabled",!1),k.prop("disabled",!1),m.prop("checked",!1).change().keyup(),k.prop("checked",!1).change().keyup(),y.hide(),h.html(l),h.addClass("error validation_message"),h.removeClass("loading Active Cancelled")}))}(jQuery)}gf_abnlookup_settings.is_ajax?(gform.addAction("gform_input_change",(function(e,o,i){for(var n in abnlookup_fields=gf_abnlookup_settings.abnlookup_fields,abnlookup_fields)if(n==i){var a=abnlookup_fields[n].validate,s=abnlookup_fields[n].dateFormat;void 0!==a&&(gf_abnlookup_settings.debug&&console.log("abn-lookup-for-gravity-forms :: field_id: "+field_id+" field_validate_abnlookup: "+a+" field_dateFormat: "+s),itsg_gf_abnlookup_function(i,a,s))}})),jQuery(document).ready((function(e){var o=gf_abnlookup_settings.abnlookup_fields,i=gf_abnlookup_settings.form_id;for(var n in o){var a=n;jQuery("#input_"+i+"_"+a).unbind("keydown").keydown((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault()})),jQuery("#input_"+i+"_"+a).unbind("keyup").keyup((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault(),numbersOnlyVal=jQuery(this).val().replace(/\D/g,""),11==numbersOnlyVal.length&&jQuery(this).trigger("change")}))}}))):jQuery(document).ready((function(e){var o=gf_abnlookup_settings.abnlookup_fields,i=gf_abnlookup_settings.form_id;for(var n in o){var a=n;jQuery("#input_"+i+"_"+a).unbind("keydown").keydown((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault()})),jQuery("#input_"+i+"_"+a).unbind("keyup").keyup((function(e){13!=e.which&&13!=e.keyCode||e.preventDefault(),numbersOnlyVal=jQuery(this).val().replace(/\D/g,""),11==numbersOnlyVal.length&&jQuery(this).trigger("change")})),jQuery("#input_"+i+"_"+a).on("change keyup",(function(e){var i=o[n].validate,s=o[n].dateFormat;void 0!==i&&(gf_abnlookup_settings.debug&&console.log("abn-lookup-for-gravity-forms :: field_id: "+a+" field_validate_abnlookup: "+i+" field_dateFormat: "+s),itsg_gf_abnlookup_function(a,i,s))}))}}));